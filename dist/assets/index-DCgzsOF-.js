var Ke=Object.defineProperty;var Xe=(n,t,e)=>t in n?Ke(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var O=(n,t,e)=>Xe(n,typeof t!="symbol"?t+"":t,e);import{polygon as He,multiPolygon as Ye}from"./index-CaRPZB-g.js";var Ze=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Te=Math.ceil,Y=Math.floor,V="[BigNumber Error] ",Ae=V+"Number primitive has more than 15 significant digits: ",W=1e14,N=14,Re=9007199254740991,Oe=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ne=1e7,F=1e9;function De(n){var t,e,s,r=S.prototype={constructor:S,toString:null,valueOf:null},a=new S(1),m=20,y=4,v=-7,w=21,R=-1e7,T=1e7,L=!1,A=1,q=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},D="0123456789abcdefghijklmnopqrstuvwxyz",de=!0;function S(i,o){var l,g,f,c,d,u,h,x,p=this;if(!(p instanceof S))return new S(i,o);if(o==null){if(i&&i._isBigNumber===!0){p.s=i.s,!i.c||i.e>T?p.c=p.e=null:i.e<R?p.c=[p.e=0]:(p.e=i.e,p.c=i.c.slice());return}if((u=typeof i=="number")&&i*0==0){if(p.s=1/i<0?(i=-i,-1):1,i===~~i){for(c=0,d=i;d>=10;d/=10,c++);c>T?p.c=p.e=null:(p.e=c,p.c=[i]);return}x=String(i)}else{if(!Ze.test(x=String(i)))return s(p,x,u);p.s=x.charCodeAt(0)==45?(x=x.slice(1),-1):1}(c=x.indexOf("."))>-1&&(x=x.replace(".","")),(d=x.search(/e/i))>0?(c<0&&(c=d),c+=+x.slice(d+1),x=x.substring(0,d)):c<0&&(c=x.length)}else{if(C(o,2,D.length,"Base"),o==10&&de)return p=new S(i),K(p,m+p.e+1,y);if(x=String(i),u=typeof i=="number"){if(i*0!=0)return s(p,x,u,o);if(p.s=1/i<0?(x=x.slice(1),-1):1,S.DEBUG&&x.replace(/^0\.0*|\./,"").length>15)throw Error(Ae+i)}else p.s=x.charCodeAt(0)===45?(x=x.slice(1),-1):1;for(l=D.slice(0,o),c=d=0,h=x.length;d<h;d++)if(l.indexOf(g=x.charAt(d))<0){if(g=="."){if(d>c){c=h;continue}}else if(!f&&(x==x.toUpperCase()&&(x=x.toLowerCase())||x==x.toLowerCase()&&(x=x.toUpperCase()))){f=!0,d=-1,c=0;continue}return s(p,String(i),u,o)}u=!1,x=e(x,o,10,p.s),(c=x.indexOf("."))>-1?x=x.replace(".",""):c=x.length}for(d=0;x.charCodeAt(d)===48;d++);for(h=x.length;x.charCodeAt(--h)===48;);if(x=x.slice(d,++h)){if(h-=d,u&&S.DEBUG&&h>15&&(i>Re||i!==Y(i)))throw Error(Ae+p.s*i);if((c=c-d-1)>T)p.c=p.e=null;else if(c<R)p.c=[p.e=0];else{if(p.e=c,p.c=[],d=(c+1)%N,c<0&&(d+=N),d<h){for(d&&p.c.push(+x.slice(0,d)),h-=N;d<h;)p.c.push(+x.slice(d,d+=N));d=N-(x=x.slice(d)).length}else d-=h;for(;d--;x+="0");p.c.push(+x)}}else p.c=[p.e=0]}S.clone=De,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(i){var o,l;if(i!=null)if(typeof i=="object"){if(i.hasOwnProperty(o="DECIMAL_PLACES")&&(l=i[o],C(l,0,F,o),m=l),i.hasOwnProperty(o="ROUNDING_MODE")&&(l=i[o],C(l,0,8,o),y=l),i.hasOwnProperty(o="EXPONENTIAL_AT")&&(l=i[o],l&&l.pop?(C(l[0],-F,0,o),C(l[1],0,F,o),v=l[0],w=l[1]):(C(l,-F,F,o),v=-(w=l<0?-l:l))),i.hasOwnProperty(o="RANGE"))if(l=i[o],l&&l.pop)C(l[0],-F,-1,o),C(l[1],1,F,o),R=l[0],T=l[1];else if(C(l,-F,F,o),l)R=-(T=l<0?-l:l);else throw Error(V+o+" cannot be zero: "+l);if(i.hasOwnProperty(o="CRYPTO"))if(l=i[o],l===!!l)if(l)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))L=l;else throw L=!l,Error(V+"crypto unavailable");else L=l;else throw Error(V+o+" not true or false: "+l);if(i.hasOwnProperty(o="MODULO_MODE")&&(l=i[o],C(l,0,9,o),A=l),i.hasOwnProperty(o="POW_PRECISION")&&(l=i[o],C(l,0,F,o),q=l),i.hasOwnProperty(o="FORMAT"))if(l=i[o],typeof l=="object")U=l;else throw Error(V+o+" not an object: "+l);if(i.hasOwnProperty(o="ALPHABET"))if(l=i[o],typeof l=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(l))de=l.slice(0,10)=="0123456789",D=l;else throw Error(V+o+" invalid: "+l)}else throw Error(V+"Object expected: "+i);return{DECIMAL_PLACES:m,ROUNDING_MODE:y,EXPONENTIAL_AT:[v,w],RANGE:[R,T],CRYPTO:L,MODULO_MODE:A,POW_PRECISION:q,FORMAT:U,ALPHABET:D}},S.isBigNumber=function(i){if(!i||i._isBigNumber!==!0)return!1;if(!S.DEBUG)return!0;var o,l,g=i.c,f=i.e,c=i.s;e:if({}.toString.call(g)=="[object Array]"){if((c===1||c===-1)&&f>=-F&&f<=F&&f===Y(f)){if(g[0]===0){if(f===0&&g.length===1)return!0;break e}if(o=(f+1)%N,o<1&&(o+=N),String(g[0]).length==o){for(o=0;o<g.length;o++)if(l=g[o],l<0||l>=W||l!==Y(l))break e;if(l!==0)return!0}}}else if(g===null&&f===null&&(c===null||c===1||c===-1))return!0;throw Error(V+"Invalid BigNumber: "+i)},S.maximum=S.max=function(){return Me(arguments,-1)},S.minimum=S.min=function(){return Me(arguments,1)},S.random=(function(){var i=9007199254740992,o=Math.random()*i&2097151?function(){return Y(Math.random()*i)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(l){var g,f,c,d,u,h=0,x=[],p=new S(a);if(l==null?l=m:C(l,0,F),d=Te(l/N),L)if(crypto.getRandomValues){for(g=crypto.getRandomValues(new Uint32Array(d*=2));h<d;)u=g[h]*131072+(g[h+1]>>>11),u>=9e15?(f=crypto.getRandomValues(new Uint32Array(2)),g[h]=f[0],g[h+1]=f[1]):(x.push(u%1e14),h+=2);h=d/2}else if(crypto.randomBytes){for(g=crypto.randomBytes(d*=7);h<d;)u=(g[h]&31)*281474976710656+g[h+1]*1099511627776+g[h+2]*4294967296+g[h+3]*16777216+(g[h+4]<<16)+(g[h+5]<<8)+g[h+6],u>=9e15?crypto.randomBytes(7).copy(g,h):(x.push(u%1e14),h+=7);h=d/7}else throw L=!1,Error(V+"crypto unavailable");if(!L)for(;h<d;)u=o(),u<9e15&&(x[h++]=u%1e14);for(d=x[--h],l%=N,d&&l&&(u=Oe[N-l],x[h]=Y(d/u)*u);x[h]===0;x.pop(),h--);if(h<0)x=[c=0];else{for(c=-1;x[0]===0;x.splice(0,1),c-=N);for(h=1,u=x[0];u>=10;u/=10,h++);h<N&&(c-=N-h)}return p.e=c,p.c=x,p}})(),S.sum=function(){for(var i=1,o=arguments,l=new S(o[0]);i<o.length;)l=l.plus(o[i++]);return l},e=(function(){var i="0123456789";function o(l,g,f,c){for(var d,u=[0],h,x=0,p=l.length;x<p;){for(h=u.length;h--;u[h]*=g);for(u[0]+=c.indexOf(l.charAt(x++)),d=0;d<u.length;d++)u[d]>f-1&&(u[d+1]==null&&(u[d+1]=0),u[d+1]+=u[d]/f|0,u[d]%=f)}return u.reverse()}return function(l,g,f,c,d){var u,h,x,p,E,b,I,M,B=l.indexOf("."),G=m,_=y;for(B>=0&&(p=q,q=0,l=l.replace(".",""),M=new S(g),b=M.pow(l.length-B),q=p,M.c=o(te(H(b.c),b.e,"0"),10,f,i),M.e=M.c.length),I=o(l,g,f,d?(u=D,i):(u=i,D)),x=p=I.length;I[--p]==0;I.pop());if(!I[0])return u.charAt(0);if(B<0?--x:(b.c=I,b.e=x,b.s=c,b=t(b,M,G,_,f),I=b.c,E=b.r,x=b.e),h=x+G+1,B=I[h],p=f/2,E=E||h<0||I[h+1]!=null,E=_<4?(B!=null||E)&&(_==0||_==(b.s<0?3:2)):B>p||B==p&&(_==4||E||_==6&&I[h-1]&1||_==(b.s<0?8:7)),h<1||!I[0])l=E?te(u.charAt(1),-G,u.charAt(0)):u.charAt(0);else{if(I.length=h,E)for(--f;++I[--h]>f;)I[h]=0,h||(++x,I=[1].concat(I));for(p=I.length;!I[--p];);for(B=0,l="";B<=p;l+=u.charAt(I[B++]));l=te(l,x,u.charAt(0))}return l}})(),t=(function(){function i(g,f,c){var d,u,h,x,p=0,E=g.length,b=f%ne,I=f/ne|0;for(g=g.slice();E--;)h=g[E]%ne,x=g[E]/ne|0,d=I*h+x*b,u=b*h+d%ne*ne+p,p=(u/c|0)+(d/ne|0)+I*x,g[E]=u%c;return p&&(g=[p].concat(g)),g}function o(g,f,c,d){var u,h;if(c!=d)h=c>d?1:-1;else for(u=h=0;u<c;u++)if(g[u]!=f[u]){h=g[u]>f[u]?1:-1;break}return h}function l(g,f,c,d){for(var u=0;c--;)g[c]-=u,u=g[c]<f[c]?1:0,g[c]=u*d+g[c]-f[c];for(;!g[0]&&g.length>1;g.splice(0,1));}return function(g,f,c,d,u){var h,x,p,E,b,I,M,B,G,_,P,z,he,ve,Se,j,se,X=g.s==f.s?1:-1,$=g.c,k=f.c;if(!$||!$[0]||!k||!k[0])return new S(!g.s||!f.s||($?k&&$[0]==k[0]:!k)?NaN:$&&$[0]==0||!k?X*0:X/0);for(B=new S(X),G=B.c=[],x=g.e-f.e,X=c+x+1,u||(u=W,x=Z(g.e/N)-Z(f.e/N),X=X/N|0),p=0;k[p]==($[p]||0);p++);if(k[p]>($[p]||0)&&x--,X<0)G.push(1),E=!0;else{for(ve=$.length,j=k.length,p=0,X+=2,b=Y(u/(k[0]+1)),b>1&&(k=i(k,b,u),$=i($,b,u),j=k.length,ve=$.length),he=j,_=$.slice(0,j),P=_.length;P<j;_[P++]=0);se=k.slice(),se=[0].concat(se),Se=k[0],k[1]>=u/2&&Se++;do{if(b=0,h=o(k,_,j,P),h<0){if(z=_[0],j!=P&&(z=z*u+(_[1]||0)),b=Y(z/Se),b>1)for(b>=u&&(b=u-1),I=i(k,b,u),M=I.length,P=_.length;o(I,_,M,P)==1;)b--,l(I,j<M?se:k,M,u),M=I.length,h=1;else b==0&&(h=b=1),I=k.slice(),M=I.length;if(M<P&&(I=[0].concat(I)),l(_,I,P,u),P=_.length,h==-1)for(;o(k,_,j,P)<1;)b++,l(_,j<P?se:k,P,u),P=_.length}else h===0&&(b++,_=[0]);G[p++]=b,_[0]?_[P++]=$[he]||0:(_=[$[he]],P=1)}while((he++<ve||_[0]!=null)&&X--);E=_[0]!=null,G[0]||G.splice(0,1)}if(u==W){for(p=1,X=G[0];X>=10;X/=10,p++);K(B,c+(B.e=p+x*N-1)+1,d,E)}else B.e=x,B.r=+E;return B}})();function we(i,o,l,g){var f,c,d,u,h;if(l==null?l=y:C(l,0,8),!i.c)return i.toString();if(f=i.c[0],d=i.e,o==null)h=H(i.c),h=g==1||g==2&&(d<=v||d>=w)?ae(h,d):te(h,d,"0");else if(i=K(new S(i),o,l),c=i.e,h=H(i.c),u=h.length,g==1||g==2&&(o<=c||c<=v)){for(;u<o;h+="0",u++);h=ae(h,c)}else if(o-=d+(g===2&&c>d),h=te(h,c,"0"),c+1>u){if(--o>0)for(h+=".";o--;h+="0");}else if(o+=c-u,o>0)for(c+1==u&&(h+=".");o--;h+="0");return i.s<0&&f?"-"+h:h}function Me(i,o){for(var l,g,f=1,c=new S(i[0]);f<i.length;f++)g=new S(i[f]),(!g.s||(l=re(c,g))===o||l===0&&c.s===o)&&(c=g);return c}function Ee(i,o,l){for(var g=1,f=o.length;!o[--f];o.pop());for(f=o[0];f>=10;f/=10,g++);return(l=g+l*N-1)>T?i.c=i.e=null:l<R?i.c=[i.e=0]:(i.e=l,i.c=o),i}s=(function(){var i=/^(-?)0([xbo])(?=\w[\w.]*$)/i,o=/^([^.]+)\.$/,l=/^\.([^.]+)$/,g=/^-?(Infinity|NaN)$/,f=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(c,d,u,h){var x,p=u?d:d.replace(f,"");if(g.test(p))c.s=isNaN(p)?null:p<0?-1:1;else{if(!u&&(p=p.replace(i,function(E,b,I){return x=(I=I.toLowerCase())=="x"?16:I=="b"?2:8,!h||h==x?b:E}),h&&(x=h,p=p.replace(o,"$1").replace(l,"0.$1")),d!=p))return new S(p,x);if(S.DEBUG)throw Error(V+"Not a"+(h?" base "+h:"")+" number: "+d);c.s=null}c.c=c.e=null}})();function K(i,o,l,g){var f,c,d,u,h,x,p,E=i.c,b=Oe;if(E){e:{for(f=1,u=E[0];u>=10;u/=10,f++);if(c=o-f,c<0)c+=N,d=o,h=E[x=0],p=Y(h/b[f-d-1]%10);else if(x=Te((c+1)/N),x>=E.length)if(g){for(;E.length<=x;E.push(0));h=p=0,f=1,c%=N,d=c-N+1}else break e;else{for(h=u=E[x],f=1;u>=10;u/=10,f++);c%=N,d=c-N+f,p=d<0?0:Y(h/b[f-d-1]%10)}if(g=g||o<0||E[x+1]!=null||(d<0?h:h%b[f-d-1]),g=l<4?(p||g)&&(l==0||l==(i.s<0?3:2)):p>5||p==5&&(l==4||g||l==6&&(c>0?d>0?h/b[f-d]:0:E[x-1])%10&1||l==(i.s<0?8:7)),o<1||!E[0])return E.length=0,g?(o-=i.e+1,E[0]=b[(N-o%N)%N],i.e=-o||0):E[0]=i.e=0,i;if(c==0?(E.length=x,u=1,x--):(E.length=x+1,u=b[N-c],E[x]=d>0?Y(h/b[f-d]%b[d])*u:0),g)for(;;)if(x==0){for(c=1,d=E[0];d>=10;d/=10,c++);for(d=E[0]+=u,u=1;d>=10;d/=10,u++);c!=u&&(i.e++,E[0]==W&&(E[0]=1));break}else{if(E[x]+=u,E[x]!=W)break;E[x--]=0,u=1}for(c=E.length;E[--c]===0;E.pop());}i.e>T?i.c=i.e=null:i.e<R&&(i.c=[i.e=0])}return i}function ee(i){var o,l=i.e;return l===null?i.toString():(o=H(i.c),o=l<=v||l>=w?ae(o,l):te(o,l,"0"),i.s<0?"-"+o:o)}return r.absoluteValue=r.abs=function(){var i=new S(this);return i.s<0&&(i.s=1),i},r.comparedTo=function(i,o){return re(this,new S(i,o))},r.decimalPlaces=r.dp=function(i,o){var l,g,f,c=this;if(i!=null)return C(i,0,F),o==null?o=y:C(o,0,8),K(new S(c),i+c.e+1,o);if(!(l=c.c))return null;if(g=((f=l.length-1)-Z(this.e/N))*N,f=l[f])for(;f%10==0;f/=10,g--);return g<0&&(g=0),g},r.dividedBy=r.div=function(i,o){return t(this,new S(i,o),m,y)},r.dividedToIntegerBy=r.idiv=function(i,o){return t(this,new S(i,o),0,1)},r.exponentiatedBy=r.pow=function(i,o){var l,g,f,c,d,u,h,x,p,E=this;if(i=new S(i),i.c&&!i.isInteger())throw Error(V+"Exponent not an integer: "+ee(i));if(o!=null&&(o=new S(o)),u=i.e>14,!E.c||!E.c[0]||E.c[0]==1&&!E.e&&E.c.length==1||!i.c||!i.c[0])return p=new S(Math.pow(+ee(E),u?i.s*(2-ce(i)):+ee(i))),o?p.mod(o):p;if(h=i.s<0,o){if(o.c?!o.c[0]:!o.s)return new S(NaN);g=!h&&E.isInteger()&&o.isInteger(),g&&(E=E.mod(o))}else{if(i.e>9&&(E.e>0||E.e<-1||(E.e==0?E.c[0]>1||u&&E.c[1]>=24e7:E.c[0]<8e13||u&&E.c[0]<=9999975e7)))return c=E.s<0&&ce(i)?-0:0,E.e>-1&&(c=1/c),new S(h?1/c:c);q&&(c=Te(q/N+2))}for(u?(l=new S(.5),h&&(i.s=1),x=ce(i)):(f=Math.abs(+ee(i)),x=f%2),p=new S(a);;){if(x){if(p=p.times(E),!p.c)break;c?p.c.length>c&&(p.c.length=c):g&&(p=p.mod(o))}if(f){if(f=Y(f/2),f===0)break;x=f%2}else if(i=i.times(l),K(i,i.e+1,1),i.e>14)x=ce(i);else{if(f=+ee(i),f===0)break;x=f%2}E=E.times(E),c?E.c&&E.c.length>c&&(E.c.length=c):g&&(E=E.mod(o))}return g?p:(h&&(p=a.div(p)),o?p.mod(o):c?K(p,q,y,d):p)},r.integerValue=function(i){var o=new S(this);return i==null?i=y:C(i,0,8),K(o,o.e+1,i)},r.isEqualTo=r.eq=function(i,o){return re(this,new S(i,o))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(i,o){return re(this,new S(i,o))>0},r.isGreaterThanOrEqualTo=r.gte=function(i,o){return(o=re(this,new S(i,o)))===1||o===0},r.isInteger=function(){return!!this.c&&Z(this.e/N)>this.c.length-2},r.isLessThan=r.lt=function(i,o){return re(this,new S(i,o))<0},r.isLessThanOrEqualTo=r.lte=function(i,o){return(o=re(this,new S(i,o)))===-1||o===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(i,o){var l,g,f,c,d=this,u=d.s;if(i=new S(i,o),o=i.s,!u||!o)return new S(NaN);if(u!=o)return i.s=-o,d.plus(i);var h=d.e/N,x=i.e/N,p=d.c,E=i.c;if(!h||!x){if(!p||!E)return p?(i.s=-o,i):new S(E?d:NaN);if(!p[0]||!E[0])return E[0]?(i.s=-o,i):new S(p[0]?d:y==3?-0:0)}if(h=Z(h),x=Z(x),p=p.slice(),u=h-x){for((c=u<0)?(u=-u,f=p):(x=h,f=E),f.reverse(),o=u;o--;f.push(0));f.reverse()}else for(g=(c=(u=p.length)<(o=E.length))?u:o,u=o=0;o<g;o++)if(p[o]!=E[o]){c=p[o]<E[o];break}if(c&&(f=p,p=E,E=f,i.s=-i.s),o=(g=E.length)-(l=p.length),o>0)for(;o--;p[l++]=0);for(o=W-1;g>u;){if(p[--g]<E[g]){for(l=g;l&&!p[--l];p[l]=o);--p[l],p[g]+=W}p[g]-=E[g]}for(;p[0]==0;p.splice(0,1),--x);return p[0]?Ee(i,p,x):(i.s=y==3?-1:1,i.c=[i.e=0],i)},r.modulo=r.mod=function(i,o){var l,g,f=this;return i=new S(i,o),!f.c||!i.s||i.c&&!i.c[0]?new S(NaN):!i.c||f.c&&!f.c[0]?new S(f):(A==9?(g=i.s,i.s=1,l=t(f,i,0,3),i.s=g,l.s*=g):l=t(f,i,0,A),i=f.minus(l.times(i)),!i.c[0]&&A==1&&(i.s=f.s),i)},r.multipliedBy=r.times=function(i,o){var l,g,f,c,d,u,h,x,p,E,b,I,M,B,G,_=this,P=_.c,z=(i=new S(i,o)).c;if(!P||!z||!P[0]||!z[0])return!_.s||!i.s||P&&!P[0]&&!z||z&&!z[0]&&!P?i.c=i.e=i.s=null:(i.s*=_.s,!P||!z?i.c=i.e=null:(i.c=[0],i.e=0)),i;for(g=Z(_.e/N)+Z(i.e/N),i.s*=_.s,h=P.length,E=z.length,h<E&&(M=P,P=z,z=M,f=h,h=E,E=f),f=h+E,M=[];f--;M.push(0));for(B=W,G=ne,f=E;--f>=0;){for(l=0,b=z[f]%G,I=z[f]/G|0,d=h,c=f+d;c>f;)x=P[--d]%G,p=P[d]/G|0,u=I*x+p*b,x=b*x+u%G*G+M[c]+l,l=(x/B|0)+(u/G|0)+I*p,M[c--]=x%B;M[c]=l}return l?++g:M.splice(0,1),Ee(i,M,g)},r.negated=function(){var i=new S(this);return i.s=-i.s||null,i},r.plus=function(i,o){var l,g=this,f=g.s;if(i=new S(i,o),o=i.s,!f||!o)return new S(NaN);if(f!=o)return i.s=-o,g.minus(i);var c=g.e/N,d=i.e/N,u=g.c,h=i.c;if(!c||!d){if(!u||!h)return new S(f/0);if(!u[0]||!h[0])return h[0]?i:new S(u[0]?g:f*0)}if(c=Z(c),d=Z(d),u=u.slice(),f=c-d){for(f>0?(d=c,l=h):(f=-f,l=u),l.reverse();f--;l.push(0));l.reverse()}for(f=u.length,o=h.length,f-o<0&&(l=h,h=u,u=l,o=f),f=0;o;)f=(u[--o]=u[o]+h[o]+f)/W|0,u[o]=W===u[o]?0:u[o]%W;return f&&(u=[f].concat(u),++d),Ee(i,u,d)},r.precision=r.sd=function(i,o){var l,g,f,c=this;if(i!=null&&i!==!!i)return C(i,1,F),o==null?o=y:C(o,0,8),K(new S(c),i,o);if(!(l=c.c))return null;if(f=l.length-1,g=f*N+1,f=l[f]){for(;f%10==0;f/=10,g--);for(f=l[0];f>=10;f/=10,g++);}return i&&c.e+1>g&&(g=c.e+1),g},r.shiftedBy=function(i){return C(i,-Re,Re),this.times("1e"+i)},r.squareRoot=r.sqrt=function(){var i,o,l,g,f,c=this,d=c.c,u=c.s,h=c.e,x=m+4,p=new S("0.5");if(u!==1||!d||!d[0])return new S(!u||u<0&&(!d||d[0])?NaN:d?c:1/0);if(u=Math.sqrt(+ee(c)),u==0||u==1/0?(o=H(d),(o.length+h)%2==0&&(o+="0"),u=Math.sqrt(+o),h=Z((h+1)/2)-(h<0||h%2),u==1/0?o="5e"+h:(o=u.toExponential(),o=o.slice(0,o.indexOf("e")+1)+h),l=new S(o)):l=new S(u+""),l.c[0]){for(h=l.e,u=h+x,u<3&&(u=0);;)if(f=l,l=p.times(f.plus(t(c,f,x,1))),H(f.c).slice(0,u)===(o=H(l.c)).slice(0,u))if(l.e<h&&--u,o=o.slice(u-3,u+1),o=="9999"||!g&&o=="4999"){if(!g&&(K(f,f.e+m+2,0),f.times(f).eq(c))){l=f;break}x+=4,u+=4,g=1}else{(!+o||!+o.slice(1)&&o.charAt(0)=="5")&&(K(l,l.e+m+2,1),i=!l.times(l).eq(c));break}}return K(l,l.e+m+1,y,i)},r.toExponential=function(i,o){return i!=null&&(C(i,0,F),i++),we(this,i,o,1)},r.toFixed=function(i,o){return i!=null&&(C(i,0,F),i=i+this.e+1),we(this,i,o)},r.toFormat=function(i,o,l){var g,f=this;if(l==null)i!=null&&o&&typeof o=="object"?(l=o,o=null):i&&typeof i=="object"?(l=i,i=o=null):l=U;else if(typeof l!="object")throw Error(V+"Argument not an object: "+l);if(g=f.toFixed(i,o),f.c){var c,d=g.split("."),u=+l.groupSize,h=+l.secondaryGroupSize,x=l.groupSeparator||"",p=d[0],E=d[1],b=f.s<0,I=b?p.slice(1):p,M=I.length;if(h&&(c=u,u=h,h=c,M-=c),u>0&&M>0){for(c=M%u||u,p=I.substr(0,c);c<M;c+=u)p+=x+I.substr(c,u);h>0&&(p+=x+I.slice(c)),b&&(p="-"+p)}g=E?p+(l.decimalSeparator||"")+((h=+l.fractionGroupSize)?E.replace(new RegExp("\\d{"+h+"}\\B","g"),"$&"+(l.fractionGroupSeparator||"")):E):p}return(l.prefix||"")+g+(l.suffix||"")},r.toFraction=function(i){var o,l,g,f,c,d,u,h,x,p,E,b,I=this,M=I.c;if(i!=null&&(u=new S(i),!u.isInteger()&&(u.c||u.s!==1)||u.lt(a)))throw Error(V+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+ee(u));if(!M)return new S(I);for(o=new S(a),x=l=new S(a),g=h=new S(a),b=H(M),c=o.e=b.length-I.e-1,o.c[0]=Oe[(d=c%N)<0?N+d:d],i=!i||u.comparedTo(o)>0?c>0?o:x:u,d=T,T=1/0,u=new S(b),h.c[0]=0;p=t(u,o,0,1),f=l.plus(p.times(g)),f.comparedTo(i)!=1;)l=g,g=f,x=h.plus(p.times(f=x)),h=f,o=u.minus(p.times(f=o)),u=f;return f=t(i.minus(l),g,0,1),h=h.plus(f.times(x)),l=l.plus(f.times(g)),h.s=x.s=I.s,c=c*2,E=t(x,g,c,y).minus(I).abs().comparedTo(t(h,l,c,y).minus(I).abs())<1?[x,g]:[h,l],T=d,E},r.toNumber=function(){return+ee(this)},r.toPrecision=function(i,o){return i!=null&&C(i,1,F),we(this,i,o,2)},r.toString=function(i){var o,l=this,g=l.s,f=l.e;return f===null?g?(o="Infinity",g<0&&(o="-"+o)):o="NaN":(i==null?o=f<=v||f>=w?ae(H(l.c),f):te(H(l.c),f,"0"):i===10&&de?(l=K(new S(l),m+f+1,y),o=te(H(l.c),l.e,"0")):(C(i,2,D.length,"Base"),o=e(te(H(l.c),f,"0"),10,i,g,!0)),g<0&&l.c[0]&&(o="-"+o)),o},r.valueOf=r.toJSON=function(){return ee(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,n!=null&&S.set(n),S}function Z(n){var t=n|0;return n>0||n===t?t:t-1}function H(n){for(var t,e,s=1,r=n.length,a=n[0]+"";s<r;){for(t=n[s++]+"",e=N-t.length;e--;t="0"+t);a+=t}for(r=a.length;a.charCodeAt(--r)===48;);return a.slice(0,r+1||1)}function re(n,t){var e,s,r=n.c,a=t.c,m=n.s,y=t.s,v=n.e,w=t.e;if(!m||!y)return null;if(e=r&&!r[0],s=a&&!a[0],e||s)return e?s?0:-y:m;if(m!=y)return m;if(e=m<0,s=v==w,!r||!a)return s?0:!r^e?1:-1;if(!s)return v>w^e?1:-1;for(y=(v=r.length)<(w=a.length)?v:w,m=0;m<y;m++)if(r[m]!=a[m])return r[m]>a[m]^e?1:-1;return v==w?0:v>w^e?1:-1}function C(n,t,e,s){if(n<t||n>e||n!==Y(n))throw Error(V+(s||"Argument")+(typeof n=="number"?n<t||n>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function ce(n){var t=n.c.length-1;return Z(n.e/N)==t&&n.c[t]%2!=0}function ae(n,t){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(t<0?"e":"e+")+t}function te(n,t,e){var s,r;if(t<0){for(r=e+".";++t;r+=e);n=r+n}else if(s=n.length,++t>s){for(r=e,t-=s;--t;r+=e);n+=r}else t<s&&(n=n.slice(0,t)+"."+n.slice(t));return n}var Q=De(),We=class{constructor(n){O(this,"key");O(this,"left",null);O(this,"right",null);this.key=n}},oe=class extends We{constructor(n){super(n)}},je=class{constructor(){O(this,"size",0);O(this,"modificationCount",0);O(this,"splayCount",0)}splay(n){const t=this.root;if(t==null)return this.compare(n,n),-1;let e=null,s=null,r=null,a=null,m=t;const y=this.compare;let v;for(;;)if(v=y(m.key,n),v>0){let w=m.left;if(w==null||(v=y(w.key,n),v>0&&(m.left=w.right,w.right=m,m=w,w=m.left,w==null)))break;e==null?s=m:e.left=m,e=m,m=w}else if(v<0){let w=m.right;if(w==null||(v=y(w.key,n),v<0&&(m.right=w.left,w.left=m,m=w,w=m.right,w==null)))break;r==null?a=m:r.right=m,r=m,m=w}else break;return r!=null&&(r.right=m.left,m.left=a),e!=null&&(e.left=m.right,m.right=s),this.root!==m&&(this.root=m,this.splayCount++),v}splayMin(n){let t=n,e=t.left;for(;e!=null;){const s=e;t.left=s.right,s.right=t,t=s,e=t.left}return t}splayMax(n){let t=n,e=t.right;for(;e!=null;){const s=e;t.right=s.left,s.left=t,t=s,e=t.right}return t}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let e=this.root;const s=e,r=e.left;if(this.size--,r==null)this.root=e.right;else{const a=e.right;e=this.splayMax(r),e.right=a,this.root=e}return this.modificationCount++,s}addNewRoot(n,t){this.size++,this.modificationCount++;const e=this.root;if(e==null){this.root=n;return}t<0?(n.left=e,n.right=e.right,e.right=null):(n.right=e,n.left=e.left,e.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,t)=>n<t?-1:n>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},qe,Fe,ye=class ue extends je{constructor(e,s){super();O(this,"root",null);O(this,"compare");O(this,"validKey");O(this,qe,"[object Set]");this.compare=e??this.defaultCompare(),this.validKey=s??(r=>r!=null&&r!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const s of e)this.delete(s)}forEach(e){const s=this[Symbol.iterator]();let r;for(;r=s.next(),!r.done;)e(r.value,r.value,this)}add(e){const s=this.splay(e);return s!=0&&this.addNewRoot(new oe(e),s),this}addAndReturn(e){const s=this.splay(e);return s!=0&&this.addNewRoot(new oe(e),s),this.root.key}addAll(e){for(const s of e)this.add(s)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let r=this.root.left;if(r==null)return null;let a=r.right;for(;a!=null;)r=a,a=r.right;return r.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let r=this.root.right;if(r==null)return null;let a=r.left;for(;a!=null;)r=a,a=r.left;return r.key}retainAll(e){const s=new ue(this.compare,this.validKey),r=this.modificationCount;for(const a of e){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(a)&&this.splay(a)==0&&s.add(this.root.key)}s.size!=this.size&&(this.root=s.root,this.size=s.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const s=new ue(this.compare,this.validKey);for(const r of this)e.has(r)&&s.add(r);return s}difference(e){const s=new ue(this.compare,this.validKey);for(const r of this)e.has(r)||s.add(r);return s}union(e){const s=this.clone();return s.addAll(e),s}clone(){const e=new ue(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function s(a,m){let y,v;do{if(y=a.left,v=a.right,y!=null){const w=new oe(y.key);m.left=w,s(y,w)}if(v!=null){const w=new oe(v.key);m.right=w,a=v,m=w}}while(v!=null)}const r=new oe(e.key);return s(e,r),r}toSet(){return this.clone()}entries(){return new Qe(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Fe=Symbol.iterator,qe=Symbol.toStringTag,Fe)](){return new Je(this.wrap())}},ze=class{constructor(n){O(this,"tree");O(this,"path",new Array);O(this,"modificationCount",null);O(this,"splayCount");this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let e=this.tree.getRoot();for(;e!=null;)this.path.push(e),e=e.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],t=n.right;if(t!=null){for(;t!=null;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},Je=class extends ze{getValue(n){return n.key}},Qe=class extends ze{getValue(n){return[n.key,n.key]}},Ue=n=>()=>n,be=n=>{const t=n?(e,s)=>s.minus(e).abs().isLessThanOrEqualTo(n):Ue(!1);return(e,s)=>t(e,s)?0:e.comparedTo(s)};function et(n){const t=n?(e,s,r,a,m)=>e.exponentiatedBy(2).isLessThanOrEqualTo(a.minus(s).exponentiatedBy(2).plus(m.minus(r).exponentiatedBy(2)).times(n)):Ue(!1);return(e,s,r)=>{const a=e.x,m=e.y,y=r.x,v=r.y,w=m.minus(v).times(s.x.minus(y)).minus(a.minus(y).times(s.y.minus(v)));return t(w,a,m,y,v)?0:w.comparedTo(0)}}var tt=n=>n,it=n=>{if(n){const t=new ye(be(n)),e=new ye(be(n)),s=(a,m)=>m.addAndReturn(a),r=a=>({x:s(a.x,t),y:s(a.y,e)});return r({x:new Q(0),y:new Q(0)}),r}return tt},Ie=n=>({set:t=>{ie=Ie(t)},reset:()=>Ie(n),compare:be(n),snap:it(n),orient:et(n)}),ie=Ie(),le=(n,t)=>n.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(n.ur.y),Le=(n,t)=>{if(t.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(t.ll.y))return null;const e=n.ll.x.isLessThan(t.ll.x)?t.ll.x:n.ll.x,s=n.ur.x.isLessThan(t.ur.x)?n.ur.x:t.ur.x,r=n.ll.y.isLessThan(t.ll.y)?t.ll.y:n.ll.y,a=n.ur.y.isLessThan(t.ur.y)?n.ur.y:t.ur.y;return{ll:{x:e,y:r},ur:{x:s,y:a}}},pe=(n,t)=>n.x.times(t.y).minus(n.y.times(t.x)),$e=(n,t)=>n.x.times(t.x).plus(n.y.times(t.y)),xe=n=>$e(n,n).sqrt(),nt=(n,t,e)=>{const s={x:t.x.minus(n.x),y:t.y.minus(n.y)},r={x:e.x.minus(n.x),y:e.y.minus(n.y)};return pe(r,s).div(xe(r)).div(xe(s))},rt=(n,t,e)=>{const s={x:t.x.minus(n.x),y:t.y.minus(n.y)},r={x:e.x.minus(n.x),y:e.y.minus(n.y)};return $e(r,s).div(xe(r)).div(xe(s))},Pe=(n,t,e)=>t.y.isZero()?null:{x:n.x.plus(t.x.div(t.y).times(e.minus(n.y))),y:e},Ce=(n,t,e)=>t.x.isZero()?null:{x:e,y:n.y.plus(t.y.div(t.x).times(e.minus(n.x)))},st=(n,t,e,s)=>{if(t.x.isZero())return Ce(e,s,n.x);if(s.x.isZero())return Ce(n,t,e.x);if(t.y.isZero())return Pe(e,s,n.y);if(s.y.isZero())return Pe(n,t,e.y);const r=pe(t,s);if(r.isZero())return null;const a={x:e.x.minus(n.x),y:e.y.minus(n.y)},m=pe(a,t).div(r),y=pe(a,s).div(r),v=n.x.plus(y.times(t.x)),w=e.x.plus(m.times(s.x)),R=n.y.plus(y.times(t.y)),T=e.y.plus(m.times(s.y)),L=v.plus(w).div(2),A=R.plus(T).div(2);return{x:L,y:A}},J=class Ve{constructor(t,e){O(this,"point");O(this,"isLeft");O(this,"segment");O(this,"otherSE");O(this,"consumedBy");t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}static compare(t,e){const s=Ve.comparePoints(t.point,e.point);return s!==0?s:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:me.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x.isLessThan(e.x)?-1:t.x.isGreaterThan(e.x)?1:t.y.isLessThan(e.y)?-1:t.y.isGreaterThan(e.y)?1:0}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let s=0,r=e.length;s<r;s++){const a=e[s];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const s=this.point.events[e];if(s.segment.consumedBy===void 0)for(let r=e+1;r<t;r++){const a=this.point.events[r];a.consumedBy===void 0&&s.otherSE.point.events===a.otherSE.point.events&&s.segment.consume(a.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,s=this.point.events.length;e<s;e++){const r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}getLeftmostComparator(t){const e=new Map,s=r=>{const a=r.otherSE;e.set(r,{sine:nt(this.point,t.point,a.point),cosine:rt(this.point,t.point,a.point)})};return(r,a)=>{e.has(r)||s(r),e.has(a)||s(a);const{sine:m,cosine:y}=e.get(r),{sine:v,cosine:w}=e.get(a);return m.isGreaterThanOrEqualTo(0)&&v.isGreaterThanOrEqualTo(0)?y.isLessThan(w)?1:y.isGreaterThan(w)?-1:0:m.isLessThan(0)&&v.isLessThan(0)?y.isLessThan(w)?-1:y.isGreaterThan(w)?1:0:v.isLessThan(m)?-1:v.isGreaterThan(m)?1:0}}},ot=class Ne{constructor(t){O(this,"events");O(this,"poly");O(this,"_isExteriorRing");O(this,"_enclosingRing");this.events=t;for(let e=0,s=t.length;e<s;e++)t[e].segment.ringOut=this;this.poly=null}static factory(t){const e=[];for(let s=0,r=t.length;s<r;s++){const a=t[s];if(!a.isInResult()||a.ringOut)continue;let m=null,y=a.leftSE,v=a.rightSE;const w=[y],R=y.point,T=[];for(;m=y,y=v,w.push(y),y.point!==R;)for(;;){const L=y.getAvailableLinkedEvents();if(L.length===0){const U=w[0].point,D=w[w.length-1].point;throw new Error(`Unable to complete output ring starting at [${U.x}, ${U.y}]. Last matching segment found ends at [${D.x}, ${D.y}].`)}if(L.length===1){v=L[0].otherSE;break}let A=null;for(let U=0,D=T.length;U<D;U++)if(T[U].point===y.point){A=U;break}if(A!==null){const U=T.splice(A)[0],D=w.splice(U.index);D.unshift(D[0].otherSE),e.push(new Ne(D.reverse()));continue}T.push({index:w.length,point:y.point});const q=y.getLeftmostComparator(m);v=L.sort(q)[0].otherSE;break}e.push(new Ne(w))}return e}getGeom(){let t=this.events[0].point;const e=[t];for(let w=1,R=this.events.length-1;w<R;w++){const T=this.events[w].point,L=this.events[w+1].point;ie.orient(T,t,L)!==0&&(e.push(T),t=T)}if(e.length===1)return null;const s=e[0],r=e[1];ie.orient(s,t,r)===0&&e.shift(),e.push(e[0]);const a=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:e.length-1,y=this.isExteriorRing()?e.length:-1,v=[];for(let w=m;w!=y;w+=a)v.push([e[w].x.toNumber(),e[w].y.toNumber()]);return v}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var r,a;let t=this.events[0];for(let m=1,y=this.events.length;m<y;m++){const v=this.events[m];J.compare(t,v)>0&&(t=v)}let e=t.segment.prevInResult(),s=e?e.prevInResult():null;for(;;){if(!e)return null;if(!s)return e.ringOut;if(s.ringOut!==e.ringOut)return((r=s.ringOut)==null?void 0:r.enclosingRing())!==e.ringOut?e.ringOut:(a=e.ringOut)==null?void 0:a.enclosingRing();e=s.prevInResult(),s=e?e.prevInResult():null}}},Be=class{constructor(n){O(this,"exteriorRing");O(this,"interiorRings");this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const t=[n];for(let e=0,s=this.interiorRings.length;e<s;e++){const r=this.interiorRings[e].getGeom();r!==null&&t.push(r)}return t}},lt=class{constructor(n){O(this,"rings");O(this,"polys");this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let t=0,e=this.polys.length;t<e;t++){const s=this.polys[t].getGeom();s!==null&&n.push(s)}return n}_composePolys(n){var e;const t=[];for(let s=0,r=n.length;s<r;s++){const a=n[s];if(!a.poly)if(a.isExteriorRing())t.push(new Be(a));else{const m=a.enclosingRing();m!=null&&m.poly||t.push(new Be(m)),(e=m==null?void 0:m.poly)==null||e.addInterior(a)}}return t}},ut=class{constructor(n,t=me.compare){O(this,"queue");O(this,"tree");O(this,"segments");this.queue=n,this.tree=new ye(t),this.segments=[]}process(n){const t=n.segment,e=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(t),e;n.isLeft&&this.tree.add(t);let s=t,r=t;do s=this.tree.lastBefore(s);while(s!=null&&s.consumedBy!=null);do r=this.tree.firstAfter(r);while(r!=null&&r.consumedBy!=null);if(n.isLeft){let a=null;if(s){const y=s.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(a=y),!s.isAnEndpoint(y))){const v=this._splitSafely(s,y);for(let w=0,R=v.length;w<R;w++)e.push(v[w])}}let m=null;if(r){const y=r.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(m=y),!r.isAnEndpoint(y))){const v=this._splitSafely(r,y);for(let w=0,R=v.length;w<R;w++)e.push(v[w])}}if(a!==null||m!==null){let y=null;a===null?y=m:m===null?y=a:y=J.comparePoints(a,m)<=0?a:m,this.queue.delete(t.rightSE),e.push(t.rightSE);const v=t.split(y);for(let w=0,R=v.length;w<R;w++)e.push(v[w])}e.length>0?(this.tree.delete(t),e.push(n)):(this.segments.push(t),t.prev=s)}else{if(s&&r){const a=s.getIntersection(r);if(a!==null){if(!s.isAnEndpoint(a)){const m=this._splitSafely(s,a);for(let y=0,v=m.length;y<v;y++)e.push(m[y])}if(!r.isAnEndpoint(a)){const m=this._splitSafely(r,a);for(let y=0,v=m.length;y<v;y++)e.push(m[y])}}}this.tree.delete(t)}return e}_splitSafely(n,t){this.tree.delete(n);const e=n.rightSE;this.queue.delete(e);const s=n.split(t);return s.push(e),n.consumedBy===void 0&&this.tree.add(n),s}},ft=class{constructor(){O(this,"type");O(this,"numMultiPolys")}run(n,t,e){fe.type=n;const s=[new Ge(t,!0)];for(let w=0,R=e.length;w<R;w++)s.push(new Ge(e[w],!1));if(fe.numMultiPolys=s.length,fe.type==="difference"){const w=s[0];let R=1;for(;R<s.length;)Le(s[R].bbox,w.bbox)!==null?R++:s.splice(R,1)}if(fe.type==="intersection")for(let w=0,R=s.length;w<R;w++){const T=s[w];for(let L=w+1,A=s.length;L<A;L++)if(Le(T.bbox,s[L].bbox)===null)return[]}const r=new ye(J.compare);for(let w=0,R=s.length;w<R;w++){const T=s[w].getSweepEvents();for(let L=0,A=T.length;L<A;L++)r.add(T[L])}const a=new ut(r);let m=null;for(r.size!=0&&(m=r.first(),r.delete(m));m;){const w=a.process(m);for(let R=0,T=w.length;R<T;R++){const L=w[R];L.consumedBy===void 0&&r.add(L)}r.size!=0?(m=r.first(),r.delete(m)):m=null}ie.reset();const y=ot.factory(a.segments);return new lt(y).getGeom()}},fe=new ft,_e=fe,ht=0,me=class ge{constructor(t,e,s,r){O(this,"id");O(this,"leftSE");O(this,"rightSE");O(this,"rings");O(this,"windings");O(this,"ringOut");O(this,"consumedBy");O(this,"prev");O(this,"_prevInResult");O(this,"_beforeState");O(this,"_afterState");O(this,"_isInResult");this.id=++ht,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=s,this.windings=r}static compare(t,e){const s=t.leftSE.point.x,r=e.leftSE.point.x,a=t.rightSE.point.x,m=e.rightSE.point.x;if(m.isLessThan(s))return 1;if(a.isLessThan(r))return-1;const y=t.leftSE.point.y,v=e.leftSE.point.y,w=t.rightSE.point.y,R=e.rightSE.point.y;if(s.isLessThan(r)){if(v.isLessThan(y)&&v.isLessThan(w))return 1;if(v.isGreaterThan(y)&&v.isGreaterThan(w))return-1;const T=t.comparePoint(e.leftSE.point);if(T<0)return 1;if(T>0)return-1;const L=e.comparePoint(t.rightSE.point);return L!==0?L:-1}if(s.isGreaterThan(r)){if(y.isLessThan(v)&&y.isLessThan(R))return-1;if(y.isGreaterThan(v)&&y.isGreaterThan(R))return 1;const T=e.comparePoint(t.leftSE.point);if(T!==0)return T;const L=t.comparePoint(e.rightSE.point);return L<0?1:L>0?-1:1}if(y.isLessThan(v))return-1;if(y.isGreaterThan(v))return 1;if(a.isLessThan(m)){const T=e.comparePoint(t.rightSE.point);if(T!==0)return T}if(a.isGreaterThan(m)){const T=t.comparePoint(e.rightSE.point);if(T<0)return 1;if(T>0)return-1}if(!a.eq(m)){const T=w.minus(y),L=a.minus(s),A=R.minus(v),q=m.minus(r);if(T.isGreaterThan(L)&&A.isLessThan(q))return 1;if(T.isLessThan(L)&&A.isGreaterThan(q))return-1}return a.isGreaterThan(m)?1:a.isLessThan(m)||w.isLessThan(R)?-1:w.isGreaterThan(R)?1:t.id<e.id?-1:t.id>e.id?1:0}static fromRing(t,e,s){let r,a,m;const y=J.comparePoints(t,e);if(y<0)r=t,a=e,m=1;else if(y>0)r=e,a=t,m=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const v=new J(r,!0),w=new J(a,!1);return new ge(v,w,[s],[m])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(e)?t:e},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(e)?t:e}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return ie.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){const e=this.bbox(),s=t.bbox(),r=Le(e,s);if(r===null)return null;const a=this.leftSE.point,m=this.rightSE.point,y=t.leftSE.point,v=t.rightSE.point,w=le(e,y)&&this.comparePoint(y)===0,R=le(s,a)&&t.comparePoint(a)===0,T=le(e,v)&&this.comparePoint(v)===0,L=le(s,m)&&t.comparePoint(m)===0;if(R&&w)return L&&!T?m:!L&&T?v:null;if(R)return T&&a.x.eq(v.x)&&a.y.eq(v.y)?null:a;if(w)return L&&m.x.eq(y.x)&&m.y.eq(y.y)?null:y;if(L&&T)return null;if(L)return m;if(T)return v;const A=st(a,this.vector(),y,t.vector());return A===null||!le(r,A)?null:ie.snap(A)}split(t){const e=[],s=t.events!==void 0,r=new J(t,!0),a=new J(t,!1),m=this.rightSE;this.replaceRightSE(a),e.push(a),e.push(r);const y=new ge(r,m,this.rings.slice(),this.windings.slice());return J.comparePoints(y.leftSE.point,y.rightSE.point)>0&&y.swapEvents(),J.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(r.checkForConsuming(),a.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,s=this.windings.length;e<s;e++)this.windings[e]*=-1}consume(t){let e=this,s=t;for(;e.consumedBy;)e=e.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const r=ge.compare(e,s);if(r!==0){if(r>0){const a=e;e=s,s=a}if(e.prev===s){const a=e;e=s,s=a}for(let a=0,m=s.rings.length;a<m;a++){const y=s.rings[a],v=s.windings[a],w=e.rings.indexOf(y);w===-1?(e.rings.push(y),e.windings.push(v)):e.windings[w]+=v}s.rings=null,s.windings=null,s.consumedBy=e,s.leftSE.consumedBy=e.leftSE,s.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,s=this._afterState.windings,r=this._afterState.multiPolys;for(let y=0,v=this.rings.length;y<v;y++){const w=this.rings[y],R=this.windings[y],T=e.indexOf(w);T===-1?(e.push(w),s.push(R)):s[T]+=R}const a=[],m=[];for(let y=0,v=e.length;y<v;y++){if(s[y]===0)continue;const w=e[y],R=w.poly;if(m.indexOf(R)===-1)if(w.isExterior)a.push(R);else{m.indexOf(R)===-1&&m.push(R);const T=a.indexOf(w.poly);T!==-1&&a.splice(T,1)}}for(let y=0,v=a.length;y<v;y++){const w=a[y].multiPoly;r.indexOf(w)===-1&&r.push(w)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(_e.type){case"union":{const s=t.length===0,r=e.length===0;this._isInResult=s!==r;break}case"intersection":{let s,r;t.length<e.length?(s=t.length,r=e.length):(s=e.length,r=t.length),this._isInResult=r===_e.numMultiPolys&&s<r;break}case"xor":{const s=Math.abs(t.length-e.length);this._isInResult=s%2===1;break}case"difference":{const s=r=>r.length===1&&r[0].isSubject;this._isInResult=s(t)!==s(e);break}}return this._isInResult}},ke=class{constructor(n,t,e){O(this,"poly");O(this,"isExterior");O(this,"segments");O(this,"bbox");if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=e,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=ie.snap({x:new Q(n[0][0]),y:new Q(n[0][1])});this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};let r=s;for(let a=1,m=n.length;a<m;a++){if(typeof n[a][0]!="number"||typeof n[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const y=ie.snap({x:new Q(n[a][0]),y:new Q(n[a][1])});y.x.eq(r.x)&&y.y.eq(r.y)||(this.segments.push(me.fromRing(r,y,this)),y.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=y.x),y.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=y.y),y.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=y.x),y.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=y.y),r=y)}(!s.x.eq(r.x)||!s.y.eq(r.y))&&this.segments.push(me.fromRing(r,s,this))}getSweepEvents(){const n=[];for(let t=0,e=this.segments.length;t<e;t++){const s=this.segments[t];n.push(s.leftSE),n.push(s.rightSE)}return n}},ct=class{constructor(n,t){O(this,"multiPoly");O(this,"exteriorRing");O(this,"interiorRings");O(this,"bbox");if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ke(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,s=n.length;e<s;e++){const r=new ke(n[e],this,!1);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=t}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let t=0,e=this.interiorRings.length;t<e;t++){const s=this.interiorRings[t].getSweepEvents();for(let r=0,a=s.length;r<a;r++)n.push(s[r])}return n}},Ge=class{constructor(n,t){O(this,"isSubject");O(this,"polys");O(this,"bbox");if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new Q(Number.POSITIVE_INFINITY),y:new Q(Number.POSITIVE_INFINITY)},ur:{x:new Q(Number.NEGATIVE_INFINITY),y:new Q(Number.NEGATIVE_INFINITY)}};for(let e=0,s=n.length;e<s;e++){const r=new ct(n[e],this);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=t}getSweepEvents(){const n=[];for(let t=0,e=this.polys.length;t<e;t++){const s=this.polys[t].getSweepEvents();for(let r=0,a=s.length;r<a;r++)n.push(s[r])}return n}},at=(n,...t)=>_e.run("union",n,t);ie.set;function pt(n,t){var e,s,r,a,m,y,v,w,R,T,L=0,A=n.type==="FeatureCollection",q=n.type==="Feature",U=A?n.features.length:1;for(e=0;e<U;e++){for(y=A?n.features[e].geometry:q?n.geometry:n,w=A?n.features[e].properties:q?n.properties:{},R=A?n.features[e].bbox:q?n.bbox:void 0,T=A?n.features[e].id:q?n.id:void 0,v=y?y.type==="GeometryCollection":!1,m=v?y.geometries.length:1,r=0;r<m;r++){if(a=v?y.geometries[r]:y,a===null){if(t(null,L,w,R,T)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,L,w,R,T)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<a.geometries.length;s++)if(t(a.geometries[s],L,w,R,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}L++}}function xt(n,t={}){const e=[];if(pt(n,r=>{e.push(r.coordinates)}),e.length<2)throw new Error("Must have at least 2 geometries");const s=at(e[0],...e.slice(1));return s.length===0?null:s.length===1?He(s[0],t.properties):Ye(s,t.properties)}export{xt as union};
